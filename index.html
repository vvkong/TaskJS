<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">    
    <title>IFE ECMAScript</title>
    
    <script>
    const sourceData = [{
        product: "手机",
        region: "华东",
        sale: [120, 100, 140, 160, 180, 185, 190, 210, 230, 245, 255, 270]
    }, {
        product: "手机",
        region: "华北",
        sale: [80, 70, 90, 110, 130, 145, 150, 160, 170, 185, 190, 200]
    }, {
        product: "手机",
        region: "华南",
        sale: [220, 200, 240, 250, 260, 270, 280, 295, 310, 335, 355, 380]
    }, {
        product: "笔记本",
        region: "华东",
        sale: [50, 60, 80, 110, 30, 20, 70, 30, 420, 30, 20, 20]
    }, {
        product: "笔记本",
        region: "华北",
        sale: [30, 35, 50, 70, 20, 15, 30, 50, 710, 130, 20, 20]
    }, {
        product: "笔记本",
        region: "华南",
        sale: [80, 120, 130, 140, 70, 75, 120, 90, 550, 120, 110, 100]
    }, {
        product: "智能音箱",
        region: "华东",
        sale: [10, 30, 4, 5, 6, 5, 4, 5, 6, 5, 5, 25]
    }, {
        product: "智能音箱",
        region: "华北",
        sale: [15, 50, 15, 15, 12, 11, 11, 12, 12, 14, 12, 40]
    }, {
        product: "智能音箱",
        region: "华南",
        sale: [10, 40, 10, 6, 5, 6, 8, 6, 6, 6, 7, 26]
    }]
    
    </script>
    <style>
        select {
            width: 120px;
            height: auto;
            margin: 10px;
            color: black;
        }
        #table {
            margin: 10px;
            border: 1px solid black;
        }
        th {
            width: 100px;
            /* border: 1px solid black; */
            background: rgb(156, 235, 235);
        }
        td {
            vertical-align: middle;
            text-align: center;
        }
    </style>
</head>
<body> 
    <section>
        <div>
            <select name="region" id="region">
            </select>
            <select name="product" id="product"></select>
        </div>
        <div class="table-wrapper">
            <table id="table">
                <tr>
                    <th>商品</th>
                    <th>地区</th>
                    <th>一月</th>
                    <th>二月</th>
                    <th>三月</th>
                    <th>四月</th>
                    <th>五月</th>
                    <th>六月</th>
                    <th>七月</th>
                    <th>八月</th>
                    <th>九月</th>
                    <th>十月</th>
                    <th>十一月</th>
                    <th>十二月</th>
                </tr>
            </table>
        </div>
    </section>

    <script>
        function init() {
            const products = new Set();
            const regions = new Set();
            sourceData.forEach( (v) => {
                products.add(v.product);
                regions.add(v.region);
            });

            let elRegion = document.getElementById('region');
            regions.forEach( (v) => {
                let opt = document.createElement('option');
                opt.setAttribute('value', v);
                opt.innerHTML = v;
                elRegion.appendChild(opt);
            });
            elRegion.firstElementChild.setAttribute('selected', 'selected');
            let elProduct = document.getElementById('product');
            products.forEach( (v) => {
                let opt = document.createElement('option');
                opt.setAttribute('value', v);
                opt.innerHTML = v;
                elProduct.appendChild(opt);
            })
            elProduct.firstElementChild.setAttribute('selected', 'selected');

            elRegion.onchange = function(e) {
                rendTable();
            };
            elProduct.onchange = function(e) {
                rendTable();
            };

            rendTable();
        }
        function rendTable() {
            let elTable = document.getElementById('table');
            while( elTable.childElementCount > 1 ) {
                elTable.removeChild(elTable.lastChild);
            }

            const regions = new Set();
            sourceData.forEach( (v) => {
                regions.add(v.region);
            });

            let region = document.getElementById('region').value;
            let product = document.getElementById('product').value;
            console.log(`region: ${region}, product: ${product}`);
            let records = sourceData.filter( (v) => {
                return (v.product === product && v.region === region);
            });
            if( records.length > 0 ) {
                let first = true;
                records.forEach( (v) => {
                    let elTr = document.createElement("tr");
                    if( first ) {
                        first = false;
                        let elTd = document.createElement('td');
                        elTd.setAttribute("rowspan", records.length);
                        elTd.innerHTML = region;
                        elTr.appendChild(elTd);

                        elTd = document.createElement('td');
                        elTd.innerHTML = product;
                        elTr.appendChild(elTd);
                    }
                    
                    v.sale.forEach( (v) => {
                        let elTd = document.createElement('td');
                        elTd.innerHTML = v;
                        elTr.appendChild(elTd);
                    });
                    
                    elTable.appendChild(elTr);                    
                })
            }
        }
        
        init();

    </script>

</body>
</html>